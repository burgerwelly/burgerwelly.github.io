<!DOCTYPE html>
<html>
  <head>

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />

    <title>
      Burger Map 2020 - Unofficial
    </title>

    <link href="vanillaSelectBox.css" rel="stylesheet"/>
    <link href='https://fonts.googleapis.com/css?family=Noto Sans' rel='stylesheet'>

    <style>

      html, body, #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      .esri-view-width-less-than-large .esri-popup__action-text {
        display: block !important;
      }

      .esri-popup__action-text {
        overflow: visible !important;
      }

      .esri-popup__main-container {
        max-height: 100% !important;
      }

      .esri-view-width-xsmall .esri-popup__main-container {
        max-height: 400px !important;
      }

      .esri-view-width-xsmall .esri-popup__actions {
        border-top: 1px solid rgba(200,200,200,1);
      }

      .esri-ui .esri-popup {
        margin-top: 60px;
      }

      #infoDiv {
        width:300px;
        height:auto;
        display:inline-block;
        padding:10px;
        box-shadow: 2px 2px 4px rgba(50,50,50,0.2);
        background-color: rgba(250,250,250,1);
        font-family: 'Noto Sans';
        text-align: center;
        vertical-align: middle;
      }

      #infoTitle {
        padding: 20px;
        border-bottom: 1px solid rgba(200,200,200,1);
        box-shadow: 0px 1px 3px rgba(50,50,50,0.2);
        background-color: rgba(255,255,255,1);
        font-weight: 600;
        font-size: 16px;
      }

      #infoKey {
        width:100%;
        height:auto;
        display:inline-block;
        padding:15px;
        margin-top: 10px;
        border-bottom: 1px solid rgba(200,200,200,1);
        box-shadow: 0px 1px 3px rgba(50,50,50,0.2);
        background-color: rgba(255,255,255,1);
      }

      #infoCredits {
        height:auto;
        width:100%;
        padding:15px;
        margin-top: 10px;
        border-bottom: 1px solid rgba(200,200,200,1);
        box-shadow: 0px 1px 3px rgba(50,50,50,0.2);
        background-color: rgba(255,255,255,1);
        font-size: 6px;
        font-style: italic;
        color: rgba(50,50,50,0.9);
      }

      #filter {
        width:300px;
        height:auto;
        display:inline-block;
        padding:10px;
        box-shadow: 2px 2px 4px rgba(50,50,50,0.2);
        background-color: rgba(250,250,250,1);
        font-family: 'Noto Sans';
        text-align: center;
        vertical-align: middle;
      }

      .filter_div {
        height:auto;
        width:100%;
        padding:15px;
        border-bottom: 1px solid rgba(200,200,200,1);
        box-shadow: 0px 1px 3px rgba(50,50,50,0.2);
        background-color: rgba(255,255,255,1);
        font-size: 14px;
        color: rgba(50,50,50,0.9);
      }

      #filterTitle {
        padding: 20px;
        border-bottom: 1px solid rgba(200,200,200,1);
        box-shadow: 0px 1px 3px rgba(50,50,50,0.2);
        background-color: rgba(255,255,255,1);
        font-weight: 600;
        font-size: 18px;
      }

      .filter_button_div {
          margin-top: 20px;
      }

      label {
          float: left;
          width: auto;
          padding: 5px;
          border-top: 10px;
          font-family: 'Noto Sans';
          text-align: left;
          font-weight: bold;
          margin-top: 10px;
      }

      .button_left {
        width: 50%;
        height: 10px;
        float: left;
        margin-bottom: 25px;
      }

      .button_right {
        width: 50%;
        height: 10px;
        float: right;
        margin-bottom: 25px;
      }

      button.filter_button, button.empty_button {
        display:inline-block;
          text-align: center;
          white-space: nowrap;
          vertical-align: middle;
          user-select: none;
          border-radius: 4px;
          z-index: 1;
          color: #333;
          background: white;
          border: 1px solid #ccc !important;
          line-height: 20px;
          font-size: 14px;
          padding: 4px;
          width: 90% !important;
      }

      button.empty_button {
        color: #969696;
        background-color: #e8e8e8;
      }

      button.filter_button:hover {
          background-color: #e0e0e0;
      }


    </style>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.16/esri/themes/light/main.css"
    />

    <script src="https://js.arcgis.com/4.16/"></script>
    <script src="vanillaSelectBox.js"></script>

  </head>

  <body>

    <div id="viewDiv"></div>

    <div id="infoDiv">
      <div id="infoTitle">Burger Wellington Map 2020</div>
      <img id="infoKey" src="https://github.com/burgerwelly/burgerwelly.github.io/blob/master/icons/Legend.png?raw=true"></img>
      <div id="infoCredits">Made as a personal project using Esri Technology<br>This map is not an offical WOAP product</div>
    </div>

    <div id="filter" class="filter">
      <div class="filter_div">

        <div class="filterTitle">

          <div class="button_left">
            <button id="filter_button" class="filter_button" style="width:140px;"
                    onClick="getValues('protein_select', 'protein', 'dietary_select',
                                        'dietary_requirements', 'availability_select',
                                        'availability', 'wheelchair_select', 'wheelchair_access',
                                        'fries_select', 'fries', 'avocado_select', 'has_avocado');">Apply Filter
            </button>
          </div>

          <div class="button_right">
            <button id="empty_button" class="empty_button" style="width:140px;" onClick="empty();">Clear Filter</button>
          </div>


        </div>

        <label>Burger Protein</label>
        <select id='protein_select' multiple size="3"></select>

        <label>Dietary Requirements</label>
        <select id='dietary_select' multiple size="3"></select>

        <label>Burger Availability</label>
        <select id='availability_select' multiple size="3"></select>

        <label>Is Wheelchair Accessible</label>
        <select id='wheelchair_select' multiple size="3"></select>

        <label>Comes with Fries</label>
        <select id='fries_select' multiple size="3"></select>

        <label>Has Avocado</label>
        <select id='avocado_select' multiple size="3"></select>
      </div>
    </div>

  </body>

  <script type="text/plain" id="beer-match-arcade">

    if ($feature["beer_match_price"] == Null){
        var PB = ""
    } else {
        var PB = "with beer $" + $feature["beer_match_price"]
    }
    return PB;

  </script>

  <script type="text/plain" id="opening-status-arcade">

    var CurrentDay = Weekday(Date())

    if (CurrentDay == 0){
        var thisDay = "Sun";
    } else if (CurrentDay == 1){
        var thisDay = "Mon";
    } else if (CurrentDay == 2){
        var thisDay = "Tue";
    } else if (CurrentDay == 3){
        var thisDay = "Wed";
    } else if (CurrentDay == 4){
        var thisDay = "Thu";
    } else if (CurrentDay == 5){
        var thisDay = "Fri";
    } else if (CurrentDay == 6){
        var thisDay = "Sat";
    }

    var days = $feature["open_hours_" + thisDay]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }

    }
    return status


  </script>
  <script type="text/plain" id="todays-hours-arcade">
    var cYear = Year(Now())
    var cMonth = Month(Now())
    var cDay = Day(Now())
    var cDate = Date(cYear,cMonth,cDay);

    var selectDay = Weekday(Date())
    //var selectDay = Weekday(DateAdd((Date()),24,"hours"))

    if (selectDay == 0){
        var thenDay = "Sun";
    } else if (selectDay == 1){
        var thenDay = "Mon";
    } else if (selectDay == 2){
        var thenDay = "Tue";
    } else if (selectDay == 3){
        var thenDay = "Wed";
    } else if (selectDay == 4){
        var thenDay = "Thu";
    } else if (selectDay == 5){
        var thenDay = "Fri";
    } else if (selectDay == 6){
        var thenDay = "Sat";
    }

    var thisDay = $feature["open_hours_" + thenDay]

    if (thisDay == "Closed"){
        var status = "Closed";
    } else if (thisDay == "Unknown"){
        var status = "Unknown"
    } else {
        var hours = Split(thisDay,'/')

        var open = hours[0]
        var close = hours[1]

        var openHour = Left(open,2)
        var openMin = Right(open,2)
        var closeHour = Left(close,2)
        var closeMin = Right(open,2)

        var openNum = Number(openHour)
        var closeNum = Number(closeHour)

        if (openNum < 12){
            var oTime = openNum + ":" + openMin + "am";
        } else if (openNum > 12 && openNum < 24){
            var n = Text(openNum-12)
            var oTime = n + ":" + openMin + "pm";
        } else if (openNum == 24){
            var n = Text(openNum-12)
            var oTime = n + ":" + openMin + "am";
        } else if (openNum == 12){
    	var oTime = openNum + ":" + openMin + "pm";
        }

        if (closeNum < 12){
            var cTime = closeNum + ":" + closeMin + "am";
        } else if (closeNum > 12 && closeNum < 24){
            var n = Text(closeNum-12)
            var cTime = n + ":" + closeMin + "pm";
        } else if (closeNum == 24){
            var n = Text(closeNum-12)
            var cTime = n + ":" + closeMin + "am";
        } else if (closeNum == 12) {
    	var cTime = closeNum + ":" + closeMin + "pm";
        }

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];

            var openHour2 = Left(open2,2)
            var openMin2 = Right(open2,2)
            var closeHour2 = Left(close2,2)
            var closeMin2 = Right(open2,2)

            var openNum2 = Number(openHour2)
            var closeNum2 = Number(closeHour2)

            if (openNum2 < 12){
                var oTime2 = openNum2 + ":" + openMin2 + "am";
            } else if (openNum2 > 12 && openNum2 < 24){
                var n2 = Text(openNum2-12)
                var oTime2 = n2 + ":" + openMin2 + "pm";
            } else if (openNum2 == 24){
                var n2 = Text(openNum2-12)
                var oTime2 = n2 + ":" + openMin2 + "am";
            } else if (openNum2 == 12) {
    	    var oTime2 = openNum2 + ":" + openMin2 + "pm";
            }

            if (closeNum2 < 12){
                var cTime2 = closeNum2 + ":" + closeMin2 + "am";
            } else if (closeNum2 > 12 && closeNum2 < 24){
                var n2 = Text(closeNum2-12)
                var cTime2 = n2 + ":" + closeMin2 + "pm";
            } else if (closeNum2 == 24){
                var n2 = Text(closeNum2-12)
                var cTime2 = n2 + ":" + closeMin2 + "am";
            } else if (closeNum2 == 12) {
    	    var cTime2 = closeNum2 + ":" + closeMin2 + "pm";
            }

            var displayTime = oTime + " to " + cTime + ' and ' + oTime2 + " to " + cTime2
            var status = displayTime

        } else {
            var displayTime = oTime + " to " + cTime;
            var status = displayTime
        };
    }

    return status
  </script>
  <script type="text/plain" id="tomorrows-hours-arcade">
    var cYear = Year(Now())
    var cMonth = Month(Now())
    var cDay = Day(Now())
    var cDate = Date(cYear,cMonth,cDay);

    //var selectDay = Weekday(Date())
    var selectDay = Weekday(DateAdd((Date()),24,"hours"))

    if (selectDay == 0){
        var thenDay = "Sun";
    } else if (selectDay == 1){
        var thenDay = "Mon";
    } else if (selectDay == 2){
        var thenDay = "Tue";
    } else if (selectDay == 3){
        var thenDay = "Wed";
    } else if (selectDay == 4){
        var thenDay = "Thu";
    } else if (selectDay == 5){
        var thenDay = "Fri";
    } else if (selectDay == 6){
        var thenDay = "Sat";
    }

    if (selectDay == 0){
        var printDay = "Sunday";
    } else if (selectDay == 1){
        var printDay = "Monday";
    } else if (selectDay == 2){
        var printDay = "Tuesday";
    } else if (selectDay == 3){
        var printDay = "Wednesday";
    } else if (selectDay == 4){
        var printDay = "Thursday";
    } else if (selectDay == 5){
        var printDay = "Friday";
    } else if (selectDay == 6){
        var printDay = "Saturday";
    }

    var thisDay = $feature["open_hours_" + thenDay]

    if (thisDay == "Closed"){
        var status = "Closed";
    }else if (thisDay == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(thisDay,'/')

        var open = hours[0]
        var close = hours[1]

        var openHour = Left(open,2)
        var openMin = Right(open,2)
        var closeHour = Left(close,2)
        var closeMin = Right(open,2)

        var openNum = Number(openHour)
        var closeNum = Number(closeHour)

        if (openNum < 12){
            var oTime = openNum + ":" + openMin + "am";
        } else if (openNum > 12 && openNum < 24){
            var n = Text(openNum-12)
            var oTime = n + ":" + openMin + "pm";
        } else if (openNum == 24){
            var n = Text(openNum-12)
            var oTime = n + ":" + openMin + "am";
        } else if (openNum == 12){
      var oTime = openNum + ":" + openMin + "pm";
        }

        if (closeNum < 12){
            var cTime = closeNum + ":" + closeMin + "am";
        } else if (closeNum > 12 && closeNum < 24){
            var n = Text(closeNum-12)
            var cTime = n + ":" + closeMin + "pm";
        } else if (closeNum == 24){
            var n = Text(closeNum-12)
            var cTime = n + ":" + closeMin + "am";
        } else if (closeNum == 12) {
      var cTime = closeNum + ":" + closeMin + "pm";
        }

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];

            var openHour2 = Left(open2,2)
            var openMin2 = Right(open2,2)
            var closeHour2 = Left(close2,2)
            var closeMin2 = Right(open2,2)

            var openNum2 = Number(openHour2)
            var closeNum2 = Number(closeHour2)

            if (openNum2 < 12){
                var oTime2 = openNum2 + ":" + openMin2 + "am";
            } else if (openNum2 > 12 && openNum2 < 24){
                var n2 = Text(openNum2-12)
                var oTime2 = n2 + ":" + openMin2 + "pm";
            } else if (openNum2 == 24){
                var n2 = Text(openNum2-12)
                var oTime2 = n2 + ":" + openMin2 + "am";
            } else if (openNum2 == 12) {
          var oTime2 = openNum2 + ":" + openMin2 + "pm";
            }

            if (closeNum2 < 12){
                var cTime2 = closeNum2 + ":" + closeMin2 + "am";
            } else if (closeNum2 > 12 && closeNum2 < 24){
                var n2 = Text(closeNum2-12)
                var cTime2 = n2 + ":" + closeMin2 + "pm";
            } else if (closeNum2 == 24){
                var n2 = Text(closeNum2-12)
                var cTime2 = n2 + ":" + closeMin2 + "am";
            } else if (closeNum2 == 12) {
          var cTime2 = closeNum2 + ":" + closeMin2 + "pm";
            }

            var displayTime = oTime + " to " + cTime + ' and ' + oTime2 + " to " + cTime2
            var status = displayTime

        } else {
            var displayTime = oTime + " to " + cTime;
            var status = displayTime
        };
    };

    var T = printDay + "'s hours: "
    var TT = Concatenate([T," ",status])
    return TT

  </script>

  <script type="text/plain" id="monday-arcade">

    var days = $feature["open_hours_Mon"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>
  <script type="text/plain" id="tuesday-arcade">

    var days = $feature["open_hours_Tue"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>
  <script type="text/plain" id="wednesday-arcade">

    var days = $feature["open_hours_Wed"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>
  <script type="text/plain" id="thursday-arcade">

    var days = $feature["open_hours_Thu"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>
  <script type="text/plain" id="friday-arcade">

    var days = $feature["open_hours_Fri"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>
  <script type="text/plain" id="saturday-arcade">

    var days = $feature["open_hours_Sat"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>
  <script type="text/plain" id="sunday-arcade">

    var days = $feature["open_hours_Sun"]

    if (days == "Closed"){
        var status = "Closed";
    } else if (days == "Unknown"){
        var status = "Unknown";
    } else {
        var hours = Split(days,'/')
        var open1 = hours[0]
        var close1 = hours[1]

        if (Count(hours) > 2){
            var open2 = hours[2];
            var close2 = hours[3];
        } else {
            var open2 = 0;
            var close2 = 0;}

        var hour = Hour(Now())
        var minute = Minute(Now())

        if (minute < 10){
            var time = Number(Text(hour) + Text(0) + Text(minute));
        } else {
            var time = Number(Text(hour) + Text(minute));
        }

        if (open1 < time && time < (close1-100)){
            var status = "Open"

        } else if ((close1-100) < time && time < close1){
            var status = "Closing Soon"

        } else if (open2 < time && time < (close2-100)){
            var status = "Open"

        } else if ((close2-100) < time && time < close2){
            var status = "Closing Soon"

        } else {
            var status = "Closed";
        }
    }
    return status


  </script>


  <script>

    require([
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/FeatureLayer",
      "esri/widgets/Home",
      "esri/widgets/Zoom",
      "esri/widgets/Compass",
      "esri/widgets/Locate",
      "esri/widgets/Search",
      "esri/widgets/Expand",
      "esri/geometry/support/webMercatorUtils",
      "esri/core/watchUtils",
    ],

    function (Map, MapView, FeatureLayer, Home, Zoom, Compass, Locate, Search, Expand, webMercatorUtils, watchUtils) {

      // Set popupTemplate

      var website = {
        title: "Website",
        id: "website",
        className: "esri-icon-globe",
      };

      var facebook = {
        title: "Facebook",
        id: "facebook",
        image: "https://www.iconfinder.com/data/icons/social-media-2285/512/1_Facebook_colored_svg_copy-512.png",
        //className: "icon brands fa-facebook-f",
      };

      var instagram = {
        title: "Instagram",
        id: "instagram",
        image: "https://www.iconfinder.com/data/icons/social-media-2285/512/1_Instagram_colored_svg_1-512.png",
        //className: "esri-icon-globe",
      };

      var arcadeExpressionInfos = [

        {
          name: "beer-match-arcade",
          title: "Beer Match",
          expression: document.getElementById("beer-match-arcade").text
        },
        {
          name: "opening-status-arcade",
          title: "Opening Status",
          expression: document.getElementById("opening-status-arcade").text
        },
        {
          name: "todays-hours-arcade",
          title: "Todays Hours",
          expression: document.getElementById("todays-hours-arcade").text
        },
        {
          name: "tomorrows-hours-arcade",
          title: "Tomorrows Hours",
          expression: document.getElementById("tomorrows-hours-arcade").text
        }
      ];

      var popup_template = {
        title:  "{burger_name}" + "<br>" +
                "{venue_name}",
        actions: [website, facebook, instagram],
        content: [
          {
            type: "text",
            text: "{burger_description}"
          },
          {
            type: "text",
            text: "<b>${burger_price}</b> " + "{expression/beer-match-arcade}" + "<br>" +
                  "<i>{dietary_requirements_display}</i>"
          },
          {
            type: "text",
            text: "Availability: {availability}" + "<br>" +
                  "Phone: {phone}" + "<br>" +
                  "Address: {address}"
          },
          {
            type: "text",
            text: "Currently: <b>{expression/opening-status-arcade}</b>" + "<br>" +
                  "Today's hours: {expression/todays-hours-arcade}" + "<br>" +
                  "{expression/tomorrows-hours-arcade}"

          },
          {
            type: "media",
            mediaInfos: [
              {
                type: "image",
                value: {
                  sourceURL: "{image}"
                }
              }
            ]
          },
          {
            type: "text",
            text: "<b>{venue_name}</b>" + "<br>" +
                  "{venue_description}" + "<p></p>"
          },
        ],
        expressionInfos: arcadeExpressionInfos
      };

      const burger_feature = new FeatureLayer({
        url:
          "https://services.arcgis.com/hMYNkrKaydBeWRXE/arcgis/rest/services/burger_locations_2020/FeatureServer/0",
          outFields: ["*"],
          title: "Burger Locations",
          popupTemplate: popup_template,
      });

      const clusterConfig = {
        type: "cluster",
        clusterRadius: "100px",
        popupTemplate: {
          content: "This cluster represents {cluster_count} burgers.",
          fieldInfos: [
            {
              fieldName: "cluster_count",
              format: {
                places: 0,
                digitSeparator: true
              }
            }
          ]
        },
        clusterMinSize: "70px",
        clusterMaxSize: "100px",
        // labelingInfo: [
        //   {
        //     deconflictionStrategy: "none",
        //     labelExpressionInfo: {
        //       expression: "Text($feature.cluster_count, '#,###')"
        //     },
        //     symbol: {
        //       type: "text",
        //       color: "#ffffff",
        //       font: {
        //         weight: "bolder",
        //         family: "Noto Sans",
        //         size: "20px"
        //       }
        //     },
        //     labelPlacement: "center-center"
        //   }
        // ]
      };

      const cluster_feature = new FeatureLayer({
        url:
          "https://services.arcgis.com/hMYNkrKaydBeWRXE/arcgis/rest/services/Clustered_Burger_Locations_2020/FeatureServer/0",
        outFields: ["*"],
        title: "Burger Locations",
        featureReduction: clusterConfig,
        popupTemplate: popup_template,
      });

      var date = new Date();
      var day = date.getDay();

      if (day == 0){
        dayArcade = document.getElementById("sunday-arcade").text;
        } else if (day == 1){
        dayArcade = document.getElementById("monday-arcade").text;
        } else if (day == 2){
        dayArcade = document.getElementById("tuesday-arcade").text;
        } else if (day == 3){
        dayArcade = document.getElementById("wednesday-arcade").text;
        } else if (day == 4){
        dayArcade = document.getElementById("thursday-arcade").text;
        } else if (day == 5){
        dayArcade = document.getElementById("friday-arcade").text;
        } else if (day == 6){
        dayArcade = document.getElementById("saturday-arcade").text;
      };

      function createSymbol(color) {
        return {
          type: "simple-marker", // autocasts as new SimpleFillSymbol()
          color: color,
          outline: {
            width: 1.5,
            color: [0, 0, 0, 1]
          },
          xoffset: 13.25,
          yoffset: 13.25,
          angle: 0
        };
      }

      var rendererTemplate = {
        type: "unique-value",
        valueExpression: dayArcade,
        valueExpressionTitle: "open-hours",
        uniqueValueInfos: [
          {
            value: "Open",
            symbol: createSymbol("#8EC63F"),
            label: "Open"
          },
          {
            value: "Closed",
            symbol: createSymbol("#F05342"),
            label: "Closed"
          },
          {
            value: "Unknown",
            symbol: createSymbol("#C1C1C1"),
            label: "Unknown"
          },
          {
            value: "Closing Soon",
            symbol: createSymbol("#F89E36"),
            label: "Closing Soon"
          }]
      };

      const hours_feature = new FeatureLayer({
        url:
          "https://services.arcgis.com/hMYNkrKaydBeWRXE/arcgis/rest/services/Opening_Hours_Burger_Locations_2020/FeatureServer",
          outFields: [],
          renderer: rendererTemplate,
          title: "Venue Hours",
      });

      const map = new Map({
        basemap: "streets-navigation-vector",
        layers: [burger_feature, hours_feature, cluster_feature]
      });

      const view = new MapView({
        container: "viewDiv",
        map: map,
        scale: 1000000,
        center: [175.2, -41.1],
        ui: {
          components: []
        },
        popup: {
          dockEnabled: true,
          actionsMenuEnabled: false,
          dockOptions: {
            breakpoint: false,
            buttonEnabled: false,
          }
        },
      });

      // search

      var searchWidget = new Search({
        view: view,
        allPlaceholder: "Restaurant or Burger",
        locationEnabled: false,
        includeDefaultSources: false,

        sources: [
          {
            layer: burger_feature,
            searchFields: ["venue_name", "burger_name"],
            suggestionTemplate: "{venue_name}, {burger_name}",
            exactMatch: false,
            outFields: ["*"],
            name: "Restaurant or Burger",
            placeholder: "Restaurant or Burger",
            maxResults: 4,
            maxSuggestions: 4,
            zoomScale: 3200,
            resultSymbol: {
               type: "simple-marker",  // autocasts as new PictureMarkerSymbol()
               size: 30,
               color: [50, 50, 50, 0],
               outline: { width: 6, color: [50, 50, 50, 1] }
            },
          }
        ]
      });


      // Create widgets

      var info_button = new Expand({
        expandIconClass: "esri-icon-description",
        view: view,
        content: infoDiv,
      });

      var home_button = new Home({
        view: view
      });

      var compass_button = new Compass({
        view: view,
      });

      var zoom_button = new Zoom({
        view: view
      });

      var locate_button = new Locate({
        view: view,
        useHeadingEnabled: false
      });

      var filter_button = new Expand({
        view: view,
        content: filter,
        expandIconClass: "esri-icon-filter",
        group: "top-left"
      });

      view.ui.add(searchWidget, "top-right");
      view.ui.add(info_button, "top-left");
      view.ui.add(filter_button, "top-left");
      view.ui.add(home_button, "top-left");
      view.ui.add(compass_button, "bottom-left");
      view.ui.add(zoom_button, "top-left");
      view.ui.add(locate_button, "top-left");
      view.ui.components = (["attribution"]);

      //view.popup.viewModel.actions.getItemAt(0).visible = false;

      function link_to_website() {
        var attributes = view.popup.selectedFeature.attributes;
        var website_link = attributes.burger_url;

        var win = window.open(website_link);
        win.opener = null;
      };

      view.popup.on("trigger-action", function(event) {
        // Execute the measureThis() function if the measure-this action is clicked
        if (event.action.id === "website") {
          link_to_website();
        }
      });

      function link_to_facebook() {
        var attributes = view.popup.selectedFeature.attributes;
        var facebook_link = attributes.facebook;

        if(facebook_link != null){
          var win = window.open(facebook_link);
          win.opener = null;
        } else {
          alert("No Facebook Link Found")
        }
      };

      view.popup.on("trigger-action", function(event) {
        // Execute the measureThis() function if the measure-this action is clicked
        if (event.action.id === "facebook") {
          link_to_facebook();
        }
      });

      function link_to_instagram() {
        var attributes = view.popup.selectedFeature.attributes;
        var instagram_link = attributes.instagram;

        if(instagram_link != "https://www.instagram.com/"){
          var win = window.open(instagram_link);
          win.opener = null;
        } else {
          alert("No Instagram Link Found")
        }
      };

      view.popup.on("trigger-action", function(event) {
        // Execute the measureThis() function if the measure-this action is clicked
        if (event.action.id === "instagram") {
          link_to_instagram();
        }
      });

      // Filters
      let cluster_layerview;
      let standard_layerview;
      let hours_layerview;

      // protein
      let proteins = ["Beef", "Chicken", "Duck", "Lamb", "Pork", "Seafood", "Sweet/Dessert", "Veggie", "Venison", "Alternative meat", "Other"];
      let select1 = document.getElementById("protein_select");
      for (var i = 0; i < proteins.length; i++) {
          var option = document.createElement("option");
          option.value = "'" + proteins[i] + "'";
          option.text = proteins[i];
          select1.appendChild(option);
      }
      let selectBox1 = new vanillaSelectBox("#protein_select",{
        "maxHeight": 200,
        "search": false ,
        "translations": {"selectAll":"Select All","clearAll":"Clear All"},
        "placeHolder": "Any"
      });

      // diet
      let dietary = ["Gluten Free", "Dairy Free", "Nut Free", "Vegetarian", "Vegan", "No Onion and Garlic"];
      let select2 = document.getElementById("dietary_select");
      for (var i = 0; i < dietary.length; i++) {
          var option = document.createElement("option");
          option.value = dietary[i];
          option.text = dietary[i];
          select2.appendChild(option);
      }
      let selectBox2 = new vanillaSelectBox("#dietary_select",{
        "maxHeight": 200,
        "search": false ,
        "translations": {"selectAll":"Select All","clearAll":"Clear All"},
        "placeHolder": "None"
      });

      // availability
      let availability = ["Breakfast", "Lunch", "Dinner"];
      let select3 = document.getElementById("availability_select");
      for (var i = 0; i < availability.length; i++) {
          var option = document.createElement("option");
          option.value = availability[i];
          option.text = availability[i];
          select3.appendChild(option);
      }
      let selectBox3 = new vanillaSelectBox("#availability_select",{
        "maxHeight": 200,
        "search": false ,
        "translations": {"selectAll":"Select All","clearAll":"Clear All"},
        "placeHolder": "None"
      });

      // wheelchair
      let wheelchair = ["Yes", "No"];
      let select4 = document.getElementById("wheelchair_select");
      for (var i = 0; i < wheelchair.length; i++) {
          var option = document.createElement("option");
          option.value = "'" + wheelchair[i] + "'";
          option.text = wheelchair[i];
          select4.appendChild(option);
      }
      let selectBox4 = new vanillaSelectBox("#wheelchair_select",{
        "maxHeight": 200,
        "search": false ,
        "placeHolder": "None",
        'disableSelectAll': true
      });

      // fries
      let fries = ["Yes", "No"];
      let select5 = document.getElementById("fries_select");
      for (var i = 0; i < fries.length; i++) {
          var option = document.createElement("option");
          option.value = "'" + fries[i] + "'";
          option.text = fries[i];
          select5.appendChild(option);
      }
      let selectBox5 = new vanillaSelectBox("#fries_select",{
        "maxHeight": 200,
        "search": false ,
        "placeHolder": "None",
        'disableSelectAll': true
      });

      // avocado
      let avocado = ["Yes", "No"];
      let select6 = document.getElementById("avocado_select");
      for (var i = 0; i < avocado.length; i++) {
          var option = document.createElement("option");
          option.value = "'" + avocado[i] + "'";
          option.text = avocado[i];
          select6.appendChild(option);
      }
      let selectBox6 = new vanillaSelectBox("#avocado_select",{
        "maxHeight": 200,
        "search": false ,
        "placeHolder": "None",
        'disableSelectAll': true
      });


      window.getValues=function(id1, entry1, id2, entry2, id3, entry3, id4, entry4, id5, entry5, id6, entry6){

          let result1 = [];
          let collection1 = document.querySelectorAll("#" + id1 + " option");
          collection1.forEach(function (x1) {
              if (x1.selected) {
                  result1.push(x1.value);
              };
          });

          let result2 = [];
          let collection2 = document.querySelectorAll("#" + id2 + " option");
          collection2.forEach(function (x2) {
              if (x2.selected) {
                  result2.push(x2.value);
              };
          });

          let result3 = [];
          let collection3 = document.querySelectorAll("#" + id3 + " option");
          collection3.forEach(function (x3) {
              if (x3.selected) {
                  result3.push(x3.value);
              };
          });

          let result4 = [];
          let collection4 = document.querySelectorAll("#" + id4 + " option");
          collection4.forEach(function (x4) {
              if (x4.selected) {
                  result4.push(x4.value);
              };
          });

          let result5 = [];
          let collection5 = document.querySelectorAll("#" + id5 + " option");
          collection5.forEach(function (x5) {
              if (x5.selected) {
                  result5.push(x5.value);
              };
          });

          let result6 = [];
          let collection6 = document.querySelectorAll("#" + id6 + " option");
          collection6.forEach(function (x6) {
              if (x6.selected) {
                  result6.push(x6.value);
              };
          });

          if(result1.length == 0){
            filter1 = entry1 + " IS NOT NULL";
          } else {
            filter1 = entry1 + " IN (" + result1 + ")";
          };

          if(result2.length == 0){
            filter2 = entry2 + " IS NOT NULL";
          } else {
            result_joined2 = result2.join("%' And " + entry2 + " LIKE '%")
            filter2 = entry2 + " LIKE '%" + result_joined2 + "%'";
          };

          if(result3.length == 0){
            filter3 = entry3 + " IS NOT NULL";
          } else {
            result_joined3 = result3.join("%' And " + entry3 + " LIKE '%")
            filter3 = entry3 + " LIKE '%" + result_joined3 + "%'";
          };

          if(result4.length == 0){
            filter4 = entry4 + " IS NOT NULL";
          } else {
            filter4 = entry4 + " IN (" + result4 + ")";
          };

          if(result5.length == 0){
            filter5 = entry5 + " IS NOT NULL";
          } else {
            filter5 = entry5 + " IN (" + result5 + ")";
          };

          if(result6.length == 0){
            filter6 = entry6 + " IS NOT NULL";
          } else {
            filter6 = entry6 + " IN (" + result6 + ")";
          };

          var filter_list = [filter1, filter2, filter3, filter4, filter5, filter6];
          var where_clause = {where: filter_list.join(" And ")}
          cluster_layerview.filter = where_clause;
          standard_layerview.filter = where_clause;
          hours_layerview.filter = where_clause;

          console.log(where_clause);

          //document.getElementById("filter_button").style.background = "#e0e0e0";
          document.getElementById("empty_button").style.background = "#fff";
          document.getElementById("empty_button").style.color = "#333";
      };

      window.empty=function() {
        selectBox1.empty();
        selectBox2.empty();
        var where_clause = {where: "OBJECTID IS NOT NULL"};
        cluster_layerview.filter = where_clause;
        standard_layerview.filter = where_clause;
        hours_layerview.filter = where_clause;
        //document.getElementById("filter_button").style.background = "#fff";
        document.getElementById("empty_button").style.background = "#e8e8e8";
        document.getElementById("empty_button").style.color = "#969696";
      };

      view.whenLayerView(cluster_feature).then(function (layerView) {
        cluster_layerview = layerView;
      });

      view.whenLayerView(burger_feature).then(function (layerView) {
        standard_layerview = layerView;
      });

      view.whenLayerView(hours_feature).then(function (layerView) {
        hours_layerview = layerView;
      });

      // Close Expand Widgets

      expandHandle1 = watchUtils.pausable(info_button, "expanded", function(newValue, oldValue){
        if(newValue === true){
          expandHandle1.pause();
          setTimeout(function(){
            expandHandle2.resume();
          }, 100);
        }else{
          expandHandle1.resume();
        }
        if(filter_button.expanded){
          filter_button.collapse();
        }
      });

      expandHandle2 = watchUtils.pausable(filter_button, "expanded", function(newValue, oldValue){
        if(newValue === true){
          expandHandle2.pause();
          setTimeout(function(){
            expandHandle1.resume();
          }, 100);
        }else{
          expandHandle2.resume();
        }
        if(info_button.expanded){
          info_button.collapse();
        }
      });

      var goto_options = {
        duration: 2000
      };

      view.on("click", function (event) {
        var screenPoint = {
          x: event.x,
          y: event.y
      };

      // Search for graphics at the clicked location
      view.hitTest(screenPoint).then(function (response) {
        if (response.results.length) {
          var graphic = response.results.filter(function (result) {
          return result.graphic.layer === burger_feature;
        })[0].graphic;}

        current_zoom = view.zoom
        extent_change = current_zoom / 20


        var lng = graphic.attributes.lng
        var lat = graphic.attributes.lat

        console.log(lat)
        console.log(current_zoom)


        view.goTo({
          extent: [lng, lat]
        },goto_options);

        // var current_extent = view.extent
        // min_extent = webMercatorUtils.xyToLngLat(current_extent.xmin, current_extent.ymin)
        // var lng1 = graphic.attributes.lng
        // var lat1 = (graphic.attributes.lat + min_extent[1]) /2

      });

      view.hitTest(screenPoint).then(function (response) {
        if (response.results.length) {
          var graphic = response.results.filter(function (result) {
          return result.graphic.layer === cluster_feature;
        })[0].graphic;}
        var lng = graphic.attributes.lng
        var lat = graphic.attributes.lat
        view.goTo({
          center: [lng, lat]
        },goto_options);
      });

    });
  });
  </script>

</html>
